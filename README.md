# 🌿 Ingrevia: 내 피부를 위한 현명한 질문의 시작

![ingrevia_mockup](/src/ingrevia_mockup.gif)


**Ingrevia**는 *Ingredient + Via*의 합성어로, 

화장품 **성분(Ingredient)을 통해 올바른 길(Via)을 제시하는** 맞춤형 추천 에이전트입니다.


---

## ✨ 프로젝트 소개
- **리뷰 평점이나 판매량이 아닌**, 제품의 **전성분 분석**을 기반으로 맞춤형 스킨케어 제품을 추천하는 것이 핵심입니다.  
- 전성분은 INCI 표준명으로 통일한 뒤, 외부 자료를 통해 확인된 **효능 성분·주의 성분**을 매핑하여 사용자의 피부 고민과 타입에 따라 **효능 성분 기준**으로 제품을 추천합니다.
<br>

### 🔑 주요 기능
- **맞춤형 질문 응답**: 피부 타입, 피부 고민, 원하는 제품 종류를 입력하면 AI가 조건을 이해
- **개인화 추천**: 조건에 맞는 제품을 찾아 추천하고 추천 이유를 함께 설명
- **설명 가능한 근거 제공**: 추천 제품의 핵심 효능 성분과 주의 성분을 정리해 투명하게 제시
- **확장성 있는 링크 제공**: 성분 배지를 클릭하면 해당 성분의 구글 검색 결과로 바로 이동
- **직관적인 인터페이스**: 버튼 선택과 자유 채팅 모두 지원, 추천 카드를 시각적으로 확인 가능
<br>

### ⚙️ 내부 구현
- 전성분을 INCI 표준명으로 정리
- 외부 자료 기반 효능/주의 성분 매핑
- 유해성 점수를 활용해 더 안전한 제품 우선 추천

---

## 🛠️ 기술 스택
- **Frontend / UI**: Streamlit
- **Backend / Logic**: Python, LangChain, LangGraph
- **AI**: OpenAI GPT-4o
- **Data**: Pandas, CSV/JSON, xlsx, plain text
- **Infra**: GitHub, LangSmith

---

## 📥 데이터 수집 및 전처리

- **데이터 출처**
  - **화해(화장품 성분 앱)**: 스킨케어 카테고리별 약 15개 제품씩 선정해 제품에 따른 기본 정보 확보  
  - **올리브영 / 브랜드 공식 홈페이지**: 화해에 전성분 정보가 없는 경우 검색을 통해 직접 수집  
  - **한국화장품협회 성분 사전**: 각 성분명을 하나씩 검색해 영문 표준명(INCI)으로 매핑  

- **전처리 과정**
  - 제품 전성분을 세미콜론을 기준으로 정리 후 리스트화  
  - 영문 표준명(INCI) 기반으로 성분을 통일  
  - INCI 매핑된 성분을 활용해 **EWG 등급** 추가  
  - 제품별 효능 태그는 화해 제품 정보를 참고해 직접 정리  
  - 최종적으로 `제품명, 브랜드명, 카테고리, 가격, 용량, 전성분, 효능, 유해성_점수, 링크` 형태의 CSV 데이터셋 구축  

- **데이터셋 규모**
  - 스킨케어 제품군 각 카테고리별 15개씩 → 총 약 120개 제품  
  - 소규모지만 **실제 시중 유통 제품**을 기반으로 성분 분석 및 추천 실험 가능

---

## 📁 프로젝트 구조

```
sesac-pjt-final/
├── README.md
├── .gitignore
├── langgraph.json
├── .env
├── venv (숨김 폴더)
│    
├── src/
│    └── graph.py
│
├── bse/ (승은 작업 공간)
│    ├── data-gathering-b.ipynb
│    ├── data_separate.ipynb
│    ├── embedding.ipynb
│    ├── design_b.ipynb
│    ├── data.xlsx
│    ├── ingredient_data.csv
│    ├── product_data.csv
│    ├── product_data.json
│    ├── product_with_score.csv
│    │     
│    │          .
│    │          .
│    │          .
│    │ 
│    ├──   (데이터 파일)
│    └── ingrevia_chatbot/
│          ├── app-final.py
│          ├── test.py
│          ├── chatbot.ipynb
│          ├── requirements.txt
│          ├── product_data.csv
│          └── .env
│    
└── soo/ (수인 작업 공간)
     ├── chatbot_1/ (테스트용)
     ├── data-gathering-s.ipynb
     ├── project_mvp.ipynb
     ├── design_s.ipynb
     ├── data.xlsx
     ├── ingredient_data.csv
     ├── product_data.csv
     ├── product_data.json
     ├── product_with_score.csv
     │
     │          .
     │          .
     │          .
     │ 
     ├──   (데이터 파일)
     └── ingrevia/
           ├── main.py
           ├── state.py
           ├── utils.py
           ├── nodes.py
           ├── langgraph.json
           ├── requirements.txt
           ├── product_data.csv
           └── .env

```


### 🗂️ 데이터 구조
`제품명, 브랜드명, 카테고리, 가격, 용량, 전성분, 효능, 유해성_점수, 링크`

---

## 👯 팀원 구성

<div align="center">

| **배승은** | **임수인** |
| :------: |  :------: |
| [<img src="https://i.pinimg.com/736x/bd/05/6e/bd056e0ff7138b992464d96dfffe8ff7.jpg" height=150 width=150> <br/> @bse1120](https://github.com/bse1120) | [<img src="https://raw.githubusercontent.com/tndls-dl/TIL/refs/heads/main/images/4.jpg" height=150 width=150> <br/> @tndls-dl](https://github.com/tndls-dl) |

</div>

### 🧩 역할 분담
🤝 **함께 한 일**
- 제품 데이터 수집, 정제 및 데이터 보강

🍌 **승은**
- 데이터분할 (csv to plain text)
- 임베딩
- streamlit을 활용한 웹 애플리케이션 제작

🍊 **수인**
- 성분 매핑 및 유해성 점수 분석
- 추천 로직 구성
- 랭체인을 통해 챗봇 구성하기 (랭스미스 연결)


---

## 👩‍💻 진행 과정

<div align="center">

![타임라인](/src/개발과정%20타임라인.jpg)

</div>


---

## ⚡ 실행 방법

1) **LangSmith (soo/ingrevia)**: LangGraph 기반 챗봇 실행  
2) **Streamlit (bse/ingrevia_chatbot)**: 웹 인터페이스 실행 

### 1. 공통 준비 단계
- 레포지토리 클론 및 이동

    ```bash
    git clone https://github.com/tndls-dl/sesac-pjt-final.git
    cd sesac-pjt-final
    ```

- 라이브러리 설치

   ```bash
   pip install -r requirements.txt
   ```

- 환경 변수 설정 (`.env`)

    ```bash
    OPENAI_API_KEY=your_api_key_here
    ```

### 2. LangSmith 실행
- 폴더 이동

    ```bash
    cd soo/ingrevia
    ```

- 실행
    ```bash
    langgraph dev
    ```

### 3. Streamlit 실행
- 폴더 이동

    ```bash
    cd bse/ingrevia_chatbot
    ```

- 실행
    ```bash
    streamlit run app-final.py
    ```

---

## ✅ 테스트 시나리오
**사용자 입력**: "건성 피부인데 보습력 좋은 크림 추천해줘"  
**추천 결과**: 보습 성분 3종 포함, 주의 성분 없음 → OOO 크림 추천 (TOP 3)

---

## 🌿 Langsmith
### 🧩 LangGraph 노드 구성
LangSmith를 통해 대화 흐름과 노드 실행을 추적하고, 다양한 입력 시나리오에 대한 반응을 시각적으로 검증했습니다.  
아래 그래프는 사용자의 입력이 어떤 단계를 거쳐 최종 추천으로 이어지는지를 보여줍니다. 

<div align="center">

![workflow](/src/랭스미스%20그래프.png)

</div>

### 🔎 주요 노드

- **Input Parser (parser)**  
  사용자 대화에서 피부 타입, 피부 고민, 제품 카테고리를 추출  

- **Profile Manager (profile_manager)**  
  추출된 정보를 프로필에 저장하고 누락된 정보는 보완  

- **Candidate Finder (search_candidates)**  
  제품 데이터셋에서 조건(타입·고민·카테고리)에 맞는 후보 제품 탐색  

- **Ingredient Analyzer (analyze_ingredients)** ✨ *LLM 사용*  
  후보 제품의 전성분을 LLM에 전달해 피부 타입·고민 기준 **핵심 효능 성분** 도출, **주의 성분** 탐지 및 추천 이유 생성 

- **Recommendation Generator (recommend)** ✨ *LLM 사용*  
  분석 결과를 기반으로 사용자 친화적인 추천 메시지 생성  

- **End (end)**  
  최종 분석 결과를 사용자에게 반환하고 대화를 마무리  

<br>

### 🎥 실행 화면

**1) 기본 질문**

사용자가 피부 타입/고민/제품 종류를 입력하면 조건에 맞는 제품을 추천합니다.

(ex. "지성인데 보습감 좋은 로션 추천해줘", "복합성, 진정, 크림")

<p align="center">
  <img src="/src/랭스미스%20기본%20질문.png" width="45%"/>
  <img src="/src/랭스미스%20기본%20질문%202.png" width="45%"/>
</p>


**2) 후속 질문**

사용자가 조건을 변경하거나 추가하면 실시간으로 다시 계산해 최적의 제품을 추천합니다.

(ex. "앰플도 추천해줘")

![후속 질문](/src/랭스미스%20후속%20질문.png)


**3) 부분 질문**

피부 타입이나 고민 중 하나만 입력하고 카테고리를 선택해도 추천이 가능합니다.

(ex. "건성인데 토너 추천해줘", "보습감 있는 선크림 추천해줘")

<p align="center">
  <img src="/src/랭스미스%20부분%20질문1.png" width="45%"/>
  <img src="/src/랭스미스%20부분%20질문2.png" width="45%"/>
</p>


**4) 다중 고민 선택**

피부 고민을 2개 이상 선택해도 조건에 맞는 추천을 제공합니다. 

(ex. "건성 피부인데 진정과 보습에 좋은 토너 제품 추천해줘")

![다중 고민](/src/랭스미스%20조건%20질문.png)


**5) 무관한 질문**

관련 없는 질문에는 “이해하지 못했다”는 안내와 함께 가이드를 제공합니다.

(ex. "오늘 날씨 어때?")

![무관한 질문](/src/랭스미스%20다른%20질문.png)
  
---

## 🌿 Streamlit
사용자는 버튼 클릭과 채팅 입력으로 쉽게 제품 추천을 받을 수 있습니다.


### 🎥 실행 화면
다음은 주요 기능을 GIF로 정리한 실행 화면입니다.

**1) 버튼 기능 이용**  
피부 타입, 고민, 제품 카테고리를 버튼으로 선택해 추천을 시작합니다.

![버튼기능_기본](/src/streamlit%20버튼%20기능_기본.gif)


**2) 다중 선택 가능**  
피부 고민이나 조건을 여러 개 선택해 맞춤형 추천을 받을 수 있습니다.  

![여러 개 선택 가능](/src/streamlit%20여러%20개%20선택%20가능.gif)


**3) 후속 질문 (예: 앰플도)**  
추천을 받은 뒤, 추가로 다른 카테고리를 요청하면 새로운 조건에 맞는 제품을 이어서 추천합니다.  

![후속 질문(채팅으로)](/src/streamlit%20후속질문_채팅(앰플도).gif)


**4) 이전 선택으로 + 선택 취소 가능**  
잘못 선택한 경우 이전 단계로 돌아가거나 선택 항목을 한 번 더 클릭해 취소할 수 있습니다.  

![이전 선택으로 + 선택 취소](/src/streamlit%20이전%20선택으로_선택%20취소.gif)


**5) 채팅 기능 이용**  
버튼 대신 자연어 채팅으로 피부 타입/고민/제품을 입력해도 추천이 가능합니다.  

![채팅 기능 이용](/src/streamlit%20채팅%20기능.gif)


**6) 왼쪽 탭 + 새 추천 시작하기**  
사이드바에서 현재 조건을 확인하거나 언제든지 “새 추천 시작하기”를 눌러 초기화할 수 있습니다.  

![왼쪽 탭 + 새 추천 시작](/src/streamlit%20왼쪽%20사이드바_새%20추천%20시작하기.gif)


**7) 기초라인 추천 가능**  
사용자가 *“기초라인 추천해줘”* 라고 입력하면,  
토너·로션·세럼·크림·선크림 등 **카테고리별로 한 제품씩** 묶어 부문별로 하나씩 추천합니다. 

![기초라인 추천 가능](/src/streamlit%20기초라인%20추천.gif)

**8) 링크 연결 가능**  
추천된 제품 이름을 클릭하면 외부 웹사이트로 연결되어 상세 정보를 확인할 수 있습니다.  

![링크 연결 가능](/src/streamlit%20링크%20연결%20가능.gif)


**9) 무관한 질문**  
관련 없는 질문에는 안내 메시지를 제공하고 대화를 이어갑니다.  
![무관한 질문](/src/ingrevia%20다른%20질문.png)


---

## 🙌 아쉬운 점 및 개선할 점

- **단순한 추천 기준**
현재는 효능 성분 개수만으로 추천을 제공하고 있어 성분 농도나 강도 비율은 고려 X
    - 향후 가중치 기반 점수화 및 정교한 스코어링 필요

- **데이터셋의 한계**
국내 제품 일부와 자체 수집 데이터에 한정되어 있어 글로벌 브랜드나 더 다양한 제품군을 포함하지 못했습니다.
    - 추가 데이터셋 연동을 통해 확장 필요

- **카테고리 다중 선택 미지원**
피부 고민은 다중 선택이 가능하지만 카테고리 선택은 아직 한 번에 하나만 가능합니다. (Langsmith 기준)
    - 카테고리별 제품 라인업 추천을 더 자연스럽게 확장 필요

- **계절/상황 맥락 부족**
현재는 계절·시간대·사용 습관에 따른 맞춤 추천을 반영하지 못했습니다.
    - 예: 겨울 보습 강화, 여름 피지 조절, 낮/밤 루틴 분리 기능 추가로 확장 가능성

- **안전성 정보 미흡**
알러지 유발 가능 성분이나 EWG 등급 등 보강이 필요합니다.
    - 신뢰성을 높이기 위해 외부 안전성 데이터 연동 필요

- **추가 기능**
현재는 성분 기반 추천에 초점이 맞춰져 있어 실제 사용자 경험을 보강할 부가 기능이 제한적입니다. 
    - 각 제품별 공식 리뷰/후기URL 연결, 사용자 평가 데이터 반영, 즐겨찾기 기능 등을 추가해 확장 가능성
 

---

## 🙌 배운 점
- LLM을 활용한 성분 분석 로직 설계 경험
- LangSmith를 통한 대화 흐름 설계 및 디버깅
- Streamlit으로 사용자 친화적 인터페이스 구축


---

## 📌 참고 자료  
- 화해(화장품 성분 앱): 제품별 효능, 기본 정보/성분 참고  
- 올리브영 / 브랜드 공식 홈페이지: 전성분 보완 수집
- 한국화장품협회 성분 사전: 성분명 → 영문 표준명(INCI) 매핑
- EWG Skin Deep Cosmetics Database: EWG 등급 확인  
